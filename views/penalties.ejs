
<h2 class="headline">Alle Mitglieder</h2>
<div class="users-grid">
  <% users.forEach(member => { %>
    <div class="user-card" onclick="openPenaltiesModal(<%= member.id %>)">
      <div class="avatar"><%= member.username[0].toUpperCase() %></div>
      <div class="username"><%= member.username %></div>
      <div class="user-strikes">Strafen: <%= member.penalties.length %></div>
      <button class="see-penalties-btn">Anzeigen</button>
    </div>
  <% }) %>
</div>

<!-- MODAL -->
<div id="penalties-modal" class="modal-backdrop" style="display:none;">
  <div class="modal-window">
    <div class="modal-header">
      <span id="modal-username"></span>
      <button onclick="closePenaltiesModal()" class="modal-close">✖</button>
    </div>
    <div id="modal-penalties-list"></div>
  </div>
</div>

<script>
  const users = <%- JSON.stringify(users) %>;
  function openPenaltiesModal(id) {
    const member = users.find(u => u.id === id);
    if (!member) return;
    document.getElementById('modal-username').textContent = member.username + ' – Strafen';
    let html = '';
    if (member.penalties.length === 0) {
      html = '<p>Keine Strafen vorhanden.</p>';
    } else {
      html = '<table class="penalties-table"><thead><tr><th>Datum</th><th>Art</th><th>Grund</th><th>Betrag</th></tr></thead><tbody>';
      let sum = 0;
      member.penalties.forEach(p => {
        const betrag = (parseFloat(p.amount) || 0).toFixed(2) + ' €';
        sum += parseFloat(p.amount) || 0;
        html += `<tr>
          <td>${p.date ? (p.date.toISOString ? p.date.toISOString().slice(0,10) : p.date) : ''}</td>
          <td>${p.type || '-'}</td>
          <td>${p.event || '-'}</td>
          <td style="text-align:right;">${betrag}</td>
        </tr>`;
      });
      html += `<tr class="sum-row"><td colspan="3" style="text-align:right;font-weight:bold;">Summe</td><td style="text-align:right;font-weight:bold;">${sum.toFixed(2)} €</td></tr>`;
      html += '</tbody></table>';
    }
    document.getElementById('modal-penalties-list').innerHTML = html;
    document.getElementById('penalties-modal').style.display = 'flex';
  }
  function closePenaltiesModal() {
    document.getElementById('penalties-modal').style.display = 'none';
  }
  document.getElementById('penalties-modal').addEventListener('click', function(e) {
    if (e.target === this) closePenaltiesModal();
  });
  window.addEventListener('keydown', function(e) {
    if (e.key === "Escape") closePenaltiesModal();
  });
</script>
